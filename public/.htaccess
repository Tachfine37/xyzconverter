# =========================================================
# xyzconverter.com — Apache Configuration
# =========================================================

# ---------------------------------------------------------
# 1. HTTPS Redirect (force all traffic to HTTPS)
# ---------------------------------------------------------
<IfModule mod_rewrite.c>
  RewriteEngine On

  # Redirect HTTP to HTTPS
  RewriteCond %{HTTPS} off
  RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

  # Redirect www to non-www (canonical domain)
  RewriteCond %{HTTP_HOST} ^www\.xyzconverter\.com [NC]
  RewriteRule ^(.*)$ https://xyzconverter.com/$1 [L,R=301]
</IfModule>

# ---------------------------------------------------------
# 2. SPA Routing — serve index.html for all routes
#    This is what fixes the 404s on tool pages for Google
# ---------------------------------------------------------
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /

  # Don't rewrite existing files, directories, or symlinks
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteCond %{REQUEST_FILENAME} !-l

  # Send everything else to index.html
  RewriteRule ^ /index.html [L]
</IfModule>

# ---------------------------------------------------------
# 3. Security Headers
# ---------------------------------------------------------
<IfModule mod_headers.c>
  # Prevent clickjacking
  Header always set X-Frame-Options "SAMEORIGIN"

  # Prevent MIME type sniffing
  Header always set X-Content-Type-Options "nosniff"

  # Enable XSS protection in older browsers
  Header always set X-XSS-Protection "1; mode=block"

  # Referrer policy
  Header always set Referrer-Policy "strict-origin-when-cross-origin"

  # Permissions policy (disable sensors/camera not needed)
  Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"

  # HSTS — tell browsers to always use HTTPS (1 year)
  Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains"
</IfModule>

# ---------------------------------------------------------
# 4. Browser Caching — speed up repeat visits
# ---------------------------------------------------------
<IfModule mod_expires.c>
  ExpiresActive On

  # HTML — short cache (content changes)
  ExpiresByType text/html                  "access plus 1 hour"

  # CSS and JS assets (Vite uses content hashes — safe to cache long)
  ExpiresByType text/css                   "access plus 1 year"
  ExpiresByType application/javascript     "access plus 1 year"
  ExpiresByType text/javascript            "access plus 1 year"

  # Images
  ExpiresByType image/png                  "access plus 6 months"
  ExpiresByType image/jpeg                 "access plus 6 months"
  ExpiresByType image/gif                  "access plus 6 months"
  ExpiresByType image/webp                 "access plus 6 months"
  ExpiresByType image/svg+xml              "access plus 6 months"
  ExpiresByType image/x-icon              "access plus 1 year"

  # Fonts
  ExpiresByType font/woff2                 "access plus 1 year"
  ExpiresByType font/woff                  "access plus 1 year"
  ExpiresByType application/font-woff2     "access plus 1 year"

  # Data files
  ExpiresByType application/json           "access plus 0 seconds"
  ExpiresByType text/xml                   "access plus 0 seconds"
</IfModule>

# ---------------------------------------------------------
# 5. Gzip Compression — faster page loads
# ---------------------------------------------------------
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/json
  AddOutputFilterByType DEFLATE image/svg+xml
  AddOutputFilterByType DEFLATE font/woff2
  AddOutputFilterByType DEFLATE font/woff
</IfModule>

# ---------------------------------------------------------
# 6. CORS for assets (needed for Web Workers like pdf.js)
# ---------------------------------------------------------
<IfModule mod_headers.c>
  <FilesMatch "\.(js|wasm)$">
    Header set Cross-Origin-Opener-Policy "same-origin"
    Header set Cross-Origin-Embedder-Policy "require-corp"
  </FilesMatch>
</IfModule>

# ---------------------------------------------------------
# 7. Prevent access to hidden files
# ---------------------------------------------------------
<FilesMatch "^\.">
  Order allow,deny
  Deny from all
</FilesMatch>

# Allow this .htaccess to be read by the server itself
<Files ".htaccess">
  Order allow,deny
  Allow from all
</Files>
